<div
  id="authModal"
  class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4"
>
  <div class="bg-white rounded-2xl max-w-md w-full p-8 relative">

    <button
      onclick="closeAuthModal()"
      class="absolute top-4 right-4"
    >
      âœ•
    </button>

    <h2 id="authTitle" class="text-xl font-semibold mb-6">
      Welcome Back
    </h2>

    {% if messages %}
      <div class="mb-4 space-y-2">
        {% for message in messages %}
          <p class="text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg px-3 py-2">
            {{ message }}
          </p>
        {% endfor %}
      </div>
    {% endif %}

    <form
      method="POST"
      id="authForm"
      action="{% url 'signin' %}"
      class="space-y-4"
    >
      {% csrf_token %}

      <div>
        <label class="block mb-1 text-sm">Username</label>
        <input
          name="username"
          required
          class="w-full border px-4 py-2 rounded-lg"
        />
      </div>

      <div id="emailField" class="hidden">
        <label class="block mb-1 text-sm">Email</label>
        <input
          name="email"
          type="email"
          class="w-full border px-4 py-2 rounded-lg"
        />
      </div>

      <div>
        <label class="block mb-1 text-sm">Password</label>
        <input
          name="password"
          type="password"
          required
          class="w-full border px-4 py-2 rounded-lg"
        />
      </div>

      <button
        type="submit"
        class="w-full py-3 bg-orange-600 text-white rounded-lg"
      >
        Sign In
      </button>
    </form>

    <p class="text-center mt-4 text-sm">
      <span id="switchText">Don't have an account?</span>
      <button
        type="button"
        onclick="switchAuthMode()"
        class="text-orange-600"
      >
        Sign Up
      </button>
    </p>

  </div>
</div>

<script>
  let authMode = "login";

  function openAuthModal(mode) {
    authMode = mode;
    const modal = document.getElementById("authModal");
    modal.classList.remove("hidden");
    modal.classList.add("flex");
    updateAuthUI();
  }

  function closeAuthModal() {
    const modal = document.getElementById("authModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
  }

  function switchAuthMode() {
    authMode = authMode === "login" ? "signup" : "login";
    updateAuthUI();
  }

  function updateAuthUI() {
    const isSignup = authMode === "signup";

    document.getElementById("authTitle").innerText =
      isSignup ? "Create Account" : "Welcome Back";

    document.getElementById("emailField")
      .classList.toggle("hidden", !isSignup);

    document.querySelector("#authForm button[type='submit']").innerText =
      isSignup ? "Create Account" : "Sign In";

    document.getElementById("switchText").innerText =
      isSignup ? "Already have an account?" : "Don't have an account?";

    document.getElementById("authForm").action =
      isSignup ? "/signup/" : "/signin/";
  }

  {% if messages %}
    window.addEventListener("DOMContentLoaded", () => {
      openAuthModal("login");
    });
  {% endif %}
</script>
